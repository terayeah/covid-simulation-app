# covid-simulation-app
## 要旨
2020年コロナウイルスによる感染拡大が世界各国で猛威を振るった。日本国内でも被害は大きく、多くの医療機関が苦しい状況に陥っている。<br>&nbsp;そのため、一つの解決策としてコロナウイルスなどの感染症ウイルスの進行の度合いを視覚的にわかりやすくし、それらの危険性を検証することを可能にし、対策を講じるためのきっかけになるようなウェブアプリケーションを作成した。本稿ではその詳細解説と検証結果についてまとめる。
## 目次
1. はじめに
2. データ
3. 詳細
4. まとめ
## 1. はじめに
今回のコロナウイルス感染拡大を機に、一つの解決策として感染症を視覚的にシミュレーションするウェブアプリケーションを作成した。このアプリの目的は視覚除法で感染の広がりを確認することで、その危機感をより現実味をもって身近に感じることを可能にすることである。また、その結果として各々が感染症対策に適切に講じることができるようにするのが狙いである。<br>&nbsp;今回作成したアプリケーションは[github](https://github.com/)で内容の全てを公開していて、完成品アプリケーションは[netlify](https://www.netlify.com/)を用いて公開している。下記にそのURLを添付する。<br>
github : https://github.com/terayeah/covid-simulation-app<br>
完成品 : https://silly-bell-a9171a.netlify.app/
## 2. データ
シミュレーションするにあたりユーザー側で操作できる変数を作成した。これらの変数はユーザー側がこのアプリでインタラクティブに扱うことのできる全てであり、つまりこのアプリの検証できる要素の全てである。
### 2.1 人口密度
アプリでは人間ひとりを球体に見立てている。ディスプレイ上にいくつもの球体が存在できるように設定していて、この変数はその数を定義するものである。アプリではdensityとして表示している。
### 2.2 感染率
ウイルスを保持した人が別の人に接触するとウイルスは他者に伝染する仕組みになっている。この変数はその伝染する確率を示すものである。アプリではinfectionRateとして表示している。
### 2.3 致死率
ウイルスを保持した人は一定期間をすぎると死亡するか抗体を獲得して無敵になる。この変数は死亡確率を示すものである。アプリではCaseFatalityRateとして表示している。
### 2.4 移動率
アプリでは一定スピードで動き回る人と全く動かない人の2パターンを用意してある。この変数を操作することによって、動き回る人の割合を設定することができる。これによって移動抑制政策がどの程度効果を発揮するのか視覚的に検証することができる。アプリではMoveRateとして表示している。
### 2.5 潜伏期間
ウイルスは人が保持したあとすぐに発症するのではなく一定期間潜伏してから発症するように設定している。この変数はその潜伏期間をフレーム数で設定するためのものである。アプリではIncubationFrameとして表示している。
### 2.6 発症期間
感染症を発症した後、一定期間発症し続けるように設定している。この変数はその期間を示したものである。アプリではOnsetFrameとして表示している。
## 3. 詳細
アプリの詳細について解説していく。まずこのアプリはブラウザで動作させるためにすべてjavascriptを用いて開発している。また当初の予定であった視覚的表現を可能にするために[p5js](https://p5js.org/)ライブラリを用いている。このライブラリは電子アートとビジュアルデザインのためのプログラミング言語processingのjavascript版である。このライブラリによってjavascriptに擬似的にループを作成して、毎フレームプログラムで作成した絵を上塗りしていくことによって視覚的な表現を可能にしている。<br>&nbsp;まずp5jsではふたつの必須の関数が存在する。ひとつがsetup()でもうひとつがdraw()だ。setup()はアプリ起動時、つまりブラウザがサーバーからhtml情報を取得したタイミングで一度だけ呼ばれる。draw()はsetup()が呼ばれた後、p5jsで擬似的に作成されたフレームで毎フレーム一回だけ呼ばれ続ける。そのためこのアプリでもsetup()で初期設定をしたのちに、draw()で人に見立てた球体の状態を管理し、それらを表示するようにしている。<br>&nbsp;また今回設計としては、状態管理を容易にするためにPersonクラスを作成した。これは人に見立てた球体そのもので、この中に感染状況や状態、球体の大きさ、速度、位置、カラーを保存した。<br>&nbsp;シミュレーションするにあたり時間の定義が必須になったため、時間をフレーム数として定義し、アプリでは固定値1000フレームとして設定した。この時間軸を元に各感染症の潜伏期間と発症期間を割合でだし、それらをまたフレーム数で設定することで検証を可能にしている。<br>&nbsp;人が移動して接触する処理に関しては球体同士が重なり合ってしまうと判定が難解になってしまうため、それぞれの球体に簡易的な衝突処理（各球体の中心との距離が半径の二倍より大きくなったら自分の速度をx,yともに-1倍する）を加え衝突があったタイミングで接触のフラグを立てることにした。<br>&nbsp;アプリではユーザーが行いたいシミュレーションに応じて変数を設定できるようにしてある。そのGUIをアプリの下部でスライダーで作成している。プログラムではこれらをsetup()で作成し、値をdraw()でget,setしている。また、GUI右部分で扱いやすくするためにシミュレーションのpauseボタンを配置した。pause内部ではdraw()ループを止める処理が行われているため前述したスライダーの値のget,setがpause時はできなくなる。そのため、新たにシミュレーション用の変数を変更したい場合は現状のシミュレーションが動いている間にスライダーで値を設定する必要がある。もし止まっていた場合は別で用意したrestartボタンを押すと、すべてのデータが破棄され新たにインスタンスを作成しスタートするのでその間に設定できる。これら一連の問題は今後解決が必要である。<br>&nbsp;球体の感染状況は色で示せるようになっている。ノーマルは白、感染は白に赤枠、発症は赤、死亡は灰、抗体獲得して生存は白に青枠である。<br>&nbsp;シミュレーション結果はリアルタイムに計測されていて、画面右下に総数と割合で表示している。
## 4. まとめ
今回作成したアプリによって感染症がどのように伝染していくのか、その全体像を視覚的に把握できるようになった。またアプリの主要な変数である人口密度と移動率は感染症の拡大の大きな要素となっていることも目で見てわかるようになった。しかし、視覚的表現の達成はできたが、いくつかシミュレーション制度の問題が発生した。それらを以下にまとめる。<br>&nbsp;まずシミュレーションにおいて人口密度や移動率と同じく重要な要素である感染率が不明瞭な点がある。現実では明確な感染率というのは計測がむずかしく、一定期間を要した後の部分的な地域で感染者の割合を出すが、感染したけど発症しなかった人などはこれに含まれないため、正確な感染率を出すのは難しい。そのためこのアプリでは感覚的な感染率を採用することでしかシミュレーションできない仕様になっている。解決策は未だ出ていない。<br>&nbsp;つぎに時間軸と接触回数のバランスが取れていない点があげられる。アプリでは時間のマックスを1000フレームにして定義してあるが、感染率が著しく低い値だと、感染の余地があるのに終了してしまう。これは接触回数がフレーム数とのバランスが取れていないことで起きていると思われる。解決策としては、まずフレーム数を伸ばすがあげられる。しかし結果シミュレーションが冗長になってしまうので、追加で早送り機能を追加すると良いかもしれない。ただ、球体の移動スピードを早くしてしまうと衝突判定で誤差が生じてしまい、うまく動作しなくなるという懸念があるため、それもふくめて改善する必要がある。また、終了した後すべてリセットするのではなく、もう一度現時点から再開するようにしたら現状のままで解決できる。<br>&nbsp;最後に感染期間と発症期間がうまく機能していない点が挙げられる。これは感染した人も発症した人も同じように扱われているためその違いが出ていない。発症した人は一定の割合で停止するなどの処理を組み込むことでより現実に近いシミュレーションができるので、それらを加えることで改善に取り組む。<br>&nbsp;以上の問題を改善してより正確なシミュレーションができるアプリにして、感染症拡大をおさえる手助けとなれるよう今後も励んでいきたい。